import { v } from './musicResponsiveListItemRenderer-cbca5691.js';
import { l } from './musicTwoRowItemRenderer-3121913c.js';
import { h as ht } from './utils-c5816fb5.js';
import './index-02d8ed20.js';
import { o, c } from './index2-e7fe418e.js';
import { N as N$1 } from './request-da4c074d.js';
import './utils.parsers-3568cb71.js';
import './index3-a50d3d2e.js';

const k=async({url:i})=>{try{const o=i.searchParams,e=o.get("list")||"",s=o.get("itct")||"",t=o.get("ctoken")||"",r=o.get("ref")||"",u=o.get("visitorData")||"",a={browseId:e};return t!==""?A(a,{ctoken:decodeURIComponent(t),continuation:decodeURIComponent(t),itct:s,type:"next"},r.slice(2),u):w(e,r)}catch(o){return new Response(void 0,{status:500,headers:{statusText:`${o}`}})}};async function A(i,o$1,e,s){const t=await N$1("playlist",{context:{client:{clientName:"WEB_REMIX",clientVersion:"1.20220404.01.00",hl:"en",visitorData:s,originalUrl:"https://music.youtube.com/playlist?list="+e}},headers:{referer:"https://music.youtube.com/playlist?list="+e},params:{},continuation:o$1});if(t===null)throw o(500,{message:"Error fetching playlist"});if(!t.ok)throw o(t.status,t.statusText);const r=await t.json(),{continuationContents:{musicPlaylistShelfContinuation:{contents:u=[],continuations:a=[]}={}}={}}=await r;let c$1=[],l;const d=a.length!==0?a[0]?.nextContinuationData:null;return r?.continuationContents?.sectionListContinuation?.contents[0]?.musicCarouselShelfRenderer?l=_(r?.continuationContents?.sectionListContinuation?.contents[0]?.musicCarouselShelfRenderer):c$1=g(u,e),c({_original:r,continuations:d,tracks:c$1.length!==0&&c$1,carousel:l})}async function w(i,o$1){const e=await fetch("https://music.youtube.com/youtubei/v1/browse?key=AIzaSyC9XL3ZjWddXya6X74dJoCTL-WEYFDNX30&prettyPrint=false",{method:"POST",body:JSON.stringify({context:{client:{clientName:"WEB_REMIX",clientVersion:"0.1",deviceMake:"google",platform:"DESKTOP",deviceModel:"bot",experimentIds:[],experimentsToken:"",osName:"Googlebot",osVersion:"2.1",locationInfo:{locationPermissionAuthorizationStatus:"LOCATION_PERMISSION_AUTHORIZATION_STATUS_UNSUPPORTED"},musicAppInfo:{musicActivityMasterSwitch:"MUSIC_ACTIVITY_MASTER_SWITCH_INDETERMINATE",musicLocationMasterSwitch:"MUSIC_LOCATION_MASTER_SWITCH_INDETERMINATE",pwaInstallabilityStatus:"PWA_INSTALLABILITY_STATUS_UNKNOWN"},utcOffsetMinutes:-new Date().getTimezoneOffset(),originalUrl:"https://music.youtube.com/playlist?list="+i,visitorData:"CgtQc1BrdVJNNVdNRSiImZ6KBg%3D%3D"},user:{lockedSafetyMode:!1}},browseId:`${i}`,browseEndpointContextMusicConfig:{pageType:"MUSIC_PAGE_TYPE_PLAYLIST"}}),headers:{"Content-Type":"application/json; charset=utf-8","X-Goog-AuthUser":"0",Origin:"https://music.youtube.com","x-origin":"https://music.youtube.com","X-Goog-Visitor-Id":"CgtQc1BrdVJNNVdNRSiImZ6KBg%3D%3D","User-Agent":"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)",referer:"https://music.youtube.com/playlist?list="+o$1||i}});if(!e.ok)throw o(e.status,{message:e.statusText});const s=await e.json();let t={};if(Object.prototype.hasOwnProperty.call(s,"header")){const{musicDetailHeaderRenderer:m={}}=s?.header;t=m;}const r=s?.responseContext?.visitorData,u=s?.contents?.singleColumnBrowseResultsRenderer?.tabs[0]?.tabRenderer?.content?.sectionListRenderer?.contents[0]?.musicPlaylistShelfRenderer.contents,a=s?.contents?.singleColumnBrowseResultsRenderer?.tabs[0]?.tabRenderer?.content?.sectionListRenderer?.contents[0]?.musicPlaylistShelfRenderer.playlistId,c$1=s?.contents?.singleColumnBrowseResultsRenderer?.tabs[0]?.tabRenderer?.content?.sectionListRenderer?.contents[0]?.musicPlaylistShelfRenderer?.continuations,l=s?.contents?.singleColumnBrowseResultsRenderer?.tabs[0]?.tabRenderer?.content?.sectionListRenderer?.continuations||null,d=s?.contents?.singleColumnBrowseResultsRenderer?.tabs[0]?.tabRenderer?.content?.sectionListRenderer?.continuations?Array.isArray(c$1)&&c$1[0]?.nextContinuationData?c$1[0]?.nextContinuationData:l[0]?.nextContinuationData:null;(()=>{const m=n=>Array.isArray(t[n].runs)&&(()=>{const h=[];for(const{text:C}of t[n].runs)h.push(C);return h})(),f=new Set(["subtitle","secondSubtitle","description","thumbnail","title"]);for(const n in t)f.has(n)||delete t[n],(n==="subtitle"||n==="secondSubtitle")&&(t[n]=t[n].runs.length!==0?m(n):[]),n==="description"&&Array.isArray(t[n]?.runs)&&t[n]?.runs.length!==0&&(t[n]=t[n].runs[0]?.text||void 0),n==="thumbnail"&&(t[n+"s"]=t[n]?.croppedSquareThumbnailRenderer?.thumbnail?.thumbnails||null,delete t[n]),n==="title"&&(t[n]=t[n].runs[0].text||"Error");t.playlistId=a,f.clear();})();const I=g(u,a??i.slice(2));return c({_original:s,continuations:d,tracks:I,visitorData:r,carouselContinuations:l&&l[0].nextContinuationData,header:t})}function g(i=[],o){let e=i.length;const s=Array(e);for(;--e>-1;)s[e]=v(i[e],!0,o)||void 0;return s}function E(i){return ht(i,({musicCarouselShelfBasicHeaderRenderer:o})=>({title:o.title.runs[0].text}))}function N(i=[]){const o=[];for(let e=0;e<i.length;e++){const s=i[e];"musicTwoRowItemRenderer"in s&&(o[e]=l(s)),"musicResponsiveListItemRenderer"in s&&(o[e]=v(s));}return o}function _(i){return {header:E([i.header])[0],results:N(i.contents)}}

export { k as GET };
//# sourceMappingURL=_server.ts-f0a77fed.js.map
