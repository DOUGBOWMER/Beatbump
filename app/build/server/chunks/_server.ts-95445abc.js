import { o, c } from './index2-e7fe418e.js';
import { v } from './musicResponsiveListItemRenderer-cbca5691.js';
import { T } from './utils-c5816fb5.js';
import './index-02d8ed20.js';
import { N } from './request-da4c074d.js';
import './utils.parsers-3568cb71.js';
import './index3-a50d3d2e.js';

const y={all:"",songs:"EgWKAQIIAWoKEAMQBBAJEAoQBQ%3D%3D",videos:"EgWKAQIQAWoKEAMQBBAJEAoQBQ%3D%3D",albums:"EgWKAQIYAWoKEAMQBBAJEAoQBQ%3D%3D",artists:"EgWKAQIgAWoKEAMQBBAJEAoQBQ%3D%3D",community_playlists:"EgeKAQQoAEABagwQDhAKEAkQAxAEEAU%3D",featured_playlists:"EgeKAQQoADgBagwQDhAKEAMQBBAJEAU%3D",all_playlists:"EgWKAQIoAWoKEAMQBBAKEAUQCQ%3D%3D"},K=async({url:i})=>{const n=i.searchParams,a=n.get("q")??"",o$1=n.get("filter")??void 0,s=n.get("ctoken")??"",e=n.get("itct")??"",r=y[o$1]??void 0;try{const t=await N("search",{context:{client:{clientName:"WEB_REMIX",clientVersion:"1.20220404.01.00"}},params:{browseId:"",query:decodeURIComponent(a),params:o$1!=="all"?`${r}`:void 0},headers:null,continuation:s!==""?{continuation:s,ctoken:s,itct:`${e}`,type:"next"}:void 0});if(!t)throw o(500,"Failed to send the search request");if(!t.ok)throw o(t.status,t.statusText);const c$1=await t.json();console.log("RESPONSE",c$1);const m=Array.isArray(c$1?.contents?.tabbedSearchResultsRenderer?.tabs)&&c$1?.contents?.tabbedSearchResultsRenderer?.tabs[0]?.tabRenderer?.content?.sectionListRenderer?.contents,p=c$1?.continuationContents?.musicShelfContinuation,A=s!==""?b(p,o$1):f(m,o$1);return console.log("RESULTS",A),c(A)}catch(t){throw console.error(t),o(500,t)}};function b(i,n){const a=x;Array.isArray(i?.continuations)&&i?.continuations[0]?.nextContinuationData;const o=n.includes("playlists")?"playlists":n,s=d(i.contents,o);return {continuation:a,results:s,type:"next"}}function f(i=[],n){const a=[],o={};let s=i.length;for(;--s>-1;){const e={contents:[],header:{title:""}},r=i[s];if(r&&r.itemSectionRenderer)continue;const t=r.musicShelfRenderer;if(t){const c=Array.isArray(t.contents)&&t.contents;if(Array.isArray(t?.continuations)&&t?.continuations[0].nextContinuationData&&Object.assign(o,t.continuations[0].nextContinuationData),t.title&&(e.header.title=t.title?.runs[0]?.text),c){const u=d(c,e.header?.title?.toLowerCase().replace(/\s/gm,"_"));e.contents=u;}a.unshift(e);}}return {results:a,continuation:o}}function d(i,n){const a=[];let o=i.length;for(;--o>-1;){const s=i[o],e=v(s),r=n==="top_result"&&e.endpoint?.pageType?.match(/SINGLE|ALBUM/i)?"albums":n;if(Object.assign(e,{type:r}),r.includes("playlists")||r==="albums"){let t="";T(e.subtitle,c=>t+=c.text),Object.assign(e,{metaData:t,browseId:s.musicResponsiveListItemRenderer?.navigationEndpoint?.browseEndpoint?.browseId,playlistId:s.musicResponsiveListItemRenderer.menu?.menuRenderer?.items[0]?.menuNavigationItemRenderer?.navigationEndpoint?.watchPlaylistEndpoint?.playlistId});}n==="songs"&&Object.assign(e,{album:e.subtitle.at(-3).pageType?.includes("ALBUM")&&e.subtitle.at(-3)}),a.unshift(e);}return a}

export { K as GET };
//# sourceMappingURL=_server.ts-95445abc.js.map
